<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>FastBot Console</title>

  <!-- Bootstrap 4 -->
  <link
    rel="stylesheet"
    href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
    integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T"
    crossorigin="anonymous"
  />

  <!-- Custom Styles -->
  <link rel="stylesheet" href="index.css" />

  <!-- Vue.js -->
  <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.min.js"></script>

  <!-- ROS libs -->
  <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/eventemitter2/lib/eventemitter2.min.js"></script>
  <script src="./libs/roslib.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/eventemitter2@5.0.1/lib/eventemitter2.min.js"></script>
  <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/easeljs/lib/easeljs.min.js"></script>
  <script type="text/javascript" src="https://s3.eu-west-1.amazonaws.com/rosject.io/js/roslib.min.js"></script>
  <script type="text/javascript" src="ros2d.js"></script>

  <!-- Camera streaming -->
  <script type="text/javascript" src="mjpegcanvas.min.js"></script>

  <!-- 2D map and 3D robot Visualization libs -->
  <script src="https://cdn.jsdelivr.net/npm/easeljs/lib/easeljs.min.js"></script>
  <script src="./libs/ros2d.js"></script>
  <script src="./libs/three.min.js"></script>
  <script src="./libs/ColladaLoader.js"></script>
  <script src="./libs/ColladaLoader2.js"></script>
  <script src="./libs/STLLoader.js"></script>
  <script src="./libs/ros3d.min.js"></script>

  <!-- Joystick -->
  <script src="https://cdn.jsdelivr.net/npm/nipplejs@0.10.1/dist/nipplejs.min.js"></script>
</head>
<body>
  <div id="app" class="app-shell">

    <!-- Top bar / connection controls -->
    <div class="topbar py-3">
      <div class="container-fluid d-flex flex-wrap align-items-center">
        <div class="mr-auto d-flex align-items-center mb-2 mb-md-0">
          <span class="brand h4 mb-0">Moon's FastBot Console</span>
        </div>

        <div class="input-group input-group-sm" style="max-width: 560px;">
          <div class="input-group-prepend">
            <span class="input-group-text">ROSBridge</span>
          </div>
          <input
            type="text"
            class="form-control"
            v-model="rosbridge_address"
            placeholder="ws://<host>:9090"
            :disabled="connected"
          />
          <div class="input-group-append" v-if="!connected">
            <button class="btn btn-accent" @click="connect" :disabled="loading || connected">Connect</button>
          </div>
          <div class="input-group-append" v-else>
            <button class="btn btn-outline-secondary" @click="disconnect">Disconnect</button>
          </div>
        </div>

        <div class="ml-3 pill">
          <span class="dot" :class="connected ? 'on' : ''"></span>
          <strong>{{ connected ? 'Connected' : 'Disconnected' }}</strong>
        </div>
      </div>
    </div>

    <!-- Main content area -->
    <div class="container-fluid content">

      <!-- Sidebar (left) -->
      <div class="panel">
        <div class="panel-body">
          <h6 class="mb-3">Robot Status</h6>
          <div class="status-chip mb-3">
            <div class="chip">
              <div class="v">{{ robotStatus.speed.toFixed(2) }} m/s</div>
              <small>Speed</small>
            </div>
            <div class="chip">
              <div class="v">{{ robotStatus.battery.toFixed(2) }}%</div>
              <small>Battery</small>
            </div>
          </div>
          <div class="status-chip mb-3">
            <div class="chip">
              <div class="v">X {{ robotStatus.position.x.toFixed(2) }}m</div>
              <small>Position</small>
            </div>
            <div class="chip">
              <div class="v">Y {{ robotStatus.position.y.toFixed(2) }}m</div>
              <small>Position</small>
            </div>
          </div>
          <div class="chip mb-4">
            <div class="v">{{ robotStatus.orientation.toFixed(1) }}°</div>
            <small>Orientation</small>
          </div>

          <h6 class="mb-3">Joystick</h6>
          <div class="joystick-wrap mb-2">
            <div id="joystickContainer"></div>
          </div>
          <div class="text-center help">Mode: <strong>{{ controlMode }}</strong></div>
        </div>
      </div>

      <!-- Center column -->
      <div class="d-grid" style="display:grid; grid-template-rows: 1fr auto; gap: 16px;">
        <div class="panel fixed-height">
          <div class="panel-body">
            <h6 class="mb-2">Environment Map</h6>
              <div class="viewer tall" id="mapViewer">
              <div class="loading" v-if="!mapLoaded">Loading map…</div>
            </div>
          </div>
        </div>

        <div class="panel">
          <div class="panel-body">
            <h6 class="mb-2">Robot 3D Model</h6>
              <div class="viewer tall" id="div3DViewer">
              <div class="loading" v-if="!robot3DLoaded">Loading 3D model…</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Right column -->
      <div class="panel">
        <div class="panel-body">
          <h6 class="mb-2">Camera</h6>
          <div class="cam-box mb-3" id="cameraViewer">
            <div class="loading" v-if="!cameraLoaded">{{ cameraStatus }}</div>
          </div>
          

          <h6 class="mb-2">Waypoints</h6>
          <div class="list-grid mb-3">
            <button
              v-for="(waypoint, key) in waypoints"
              :key="key"
              class="btn btn-waypoint"
              @click="goToWaypoint(key)"
              :disabled="!connected || isNavigating"
            >
              {{ waypoint.name }}
            </button>
          </div>

          <button
            class="btn btn-emph btn-lg btn-block"
            @click="emergencyStop"
            :disabled="!connected"
          >
            STOP
          </button>
        </div>
      </div>

    </div>
  </div>

  <!-- Cache-busted main.js loader -->
  <script type="text/javascript">
    var script = document.createElement('script');
    script.type = 'text/javascript';
    script.src = 'main.js?v=17.' + Date.now();
    document.head.appendChild(script);
  </script>
</body>
</html>